<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Graded Game of Life â€” Brutalist</title>
  <style>
    body {
      margin: 0;
      background: white;
      font-family: monospace;
      color: black;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: white;
      cursor: crosshair;
      margin: 1rem 0;
      border: 2px solid black;
      image-rendering: pixelated;
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      width: 95%;
      max-width: 1200px;
      background: white;
      padding: 1rem;
      border: 2px solid black;
      text-align: left;
    }
    h4 {
      margin-top: 0;
      font-weight: bold;
      font-size: 1rem;
      border-bottom: 2px solid black;
    }
    .control-group {
      margin-bottom: 0.5rem;
    }
    label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 0.2rem;
    }
    input[type="range"] {
      width: 100%;
    }
    input[type="text"], button {
      padding: 0.4rem 0.6rem;
      border: 2px solid black;
      background: white;
      font-size: 0.9rem;
      font-family: monospace;
      color: black;
    }
    input[type="text"] {
      width: 300px;
    }
    button {
      font-weight: bold;
      cursor: pointer;
    }
    .button-row {
      margin-bottom: 1rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
    }
    .preset-row {
      margin-bottom: 1rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="controls">
    <div>
      <h4>Birth</h4>
      <div class="control-group">
        <label for="birthMin">Birth Min: <span id="birthMinLabel"></span></label>
        <input type="range" id="birthMin" min="0" max="8" step="0.1" value="2.6667" oninput="document.getElementById('birthMinLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label for="birthMax">Birth Max: <span id="birthMaxLabel"></span></label>
        <input type="range" id="birthMax" min="0" max="8" step="0.1" value="4.8" oninput="document.getElementById('birthMaxLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label for="birthBoost">Birth Boost: <span id="birthBoostLabel"></span></label>
        <input type="range" id="birthBoost" min="0" max="255" value="191" oninput="document.getElementById('birthBoostLabel').textContent=this.value">
      </div>
    </div>
    <div>
      <h4>Survival</h4>
      <div class="control-group">
        <label for="surviveMin">Survive Min: <span id="surviveMinLabel"></span></label>
        <input type="range" id="surviveMin" min="0" max="8" step="0.1" value="3.2" oninput="document.getElementById('surviveMinLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label for="surviveMax">Survive Max: <span id="surviveMaxLabel"></span></label>
        <input type="range" id="surviveMax" min="0" max="8" step="0.1" value="6" oninput="document.getElementById('surviveMaxLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label for="survivalGain">Survival Gain: <span id="survivalGainLabel"></span></label>
        <input type="range" id="survivalGain" min="0" max="10" value="0" oninput="document.getElementById('survivalGainLabel').textContent=this.value">
      </div>
    </div>
    <div>
      <h4>Decay & Drawing</h4>
      <div class="control-group">
        <label for="decayRate">Decay Rate: <span id="decayRateLabel"></span></label>
        <input type="range" id="decayRate" min="0" max="255" value="255" oninput="document.getElementById('decayRateLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label for="drawIntensity">Draw Intensity: <span id="drawIntensityLabel"></span></label>
        <input type="range" id="drawIntensity" min="0" max="255" value="255" oninput="document.getElementById('drawIntensityLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label for="brushSize">Brush Size: <span id="brushSizeLabel"></span></label>
        <input type="range" id="brushSize" min="1" max="10" value="3" oninput="document.getElementById('brushSizeLabel').textContent=this.value">
      </div>
      <div class="control-group">
        <label><input type="checkbox" id="eraser"> Eraser</label>
      </div>
    </div>
  </div>

  <canvas id="lifeCanvas" width="400" height="400" style="width: 800px; height: 800px;"></canvas>
  <div class="button-row">
    <button id="togglePlay">Pause</button>
    <button id="clearButton">Clear</button>
  </div>
  <div class="button-row">
    <button onclick="copyPresetCode()">Copy Preset Code</button>
    <input type="text" id="presetInput" placeholder="Enter preset code">
    <button onclick="applyPresetCode()">Apply</button>
  </div>
  <div class="preset-row">
    <span>Try these!</span>
    <button onclick="setPreset('2.4,3.2,3.2,5.9,194,36,8,255,6')">Preset 1</button>
    <button onclick="setPreset('2.4,3.2,3.2,3.8,149,18,9,255,7')">Preset 2</button>
    <button onclick="setPreset('2.4,3.2,3.2,5.9,194,36,8,255,6')">Preset 3</button>
  </div>

  <script>
    // JS unchanged from before
    const canvas = document.getElementById("lifeCanvas");
    const ctx = canvas.getContext("2d");
    const width = canvas.width;
    const height = canvas.height;
    const resolution = 2;
    const cols = width / resolution;
    const rows = height / resolution;

    let grid = new Array(cols).fill(null).map(() => new Array(rows).fill(0).map(() => Math.floor(Math.random() * 256)));
    let momentum = new Array(cols).fill(null).map(() => new Array(rows).fill(0));

    function drawGrid() {
      for (let x = 0; x < cols; ++x) {
        for (let y = 0; y < rows; ++y) {
          const val = grid[x][y];
          ctx.fillStyle = `rgb(${val},${val},${val})`;
          ctx.fillRect(x * resolution, y * resolution, resolution, resolution);
        }
      }
    }

    function countNeighbors(grid, x, y) {
      let total = 0;
      for (let i = -1; i <= 1; i++) {
        for (let j = -1; j <= 1; j++) {
          if (i === 0 && j === 0) continue;
          const col = (x + i + cols) % cols;
          const row = (y + j + rows) % rows;
          total += grid[col][row] / 255;
        }
      }
      return total;
    }

    function update() {
      const birthMin = parseFloat(document.getElementById("birthMin").value);
      const birthMax = parseFloat(document.getElementById("birthMax").value);
      const surviveMin = parseFloat(document.getElementById("surviveMin").value);
      const surviveMax = parseFloat(document.getElementById("surviveMax").value);
      const birthBoost = parseInt(document.getElementById("birthBoost").value);
      const decayRate = parseInt(document.getElementById("decayRate").value);
      const survivalGain = parseInt(document.getElementById("survivalGain").value);

      const next = Array.from({ length: cols }, () => new Array(rows));

      for (let x = 0; x < cols; ++x) {
        const col = grid[x];
        const momCol = momentum[x];
        const nextCol = next[x];
        for (let y = 0; y < rows; ++y) {
          const neighbors = countNeighbors(grid, x, y);
          const current = col[y];

          let delta = 0;
          if (current < 20 && neighbors >= birthMin && neighbors <= birthMax) {
            delta = birthBoost;
          } else if (current >= 20 && neighbors >= surviveMin && neighbors <= surviveMax) {
            delta = survivalGain;
          } else {
            delta = -decayRate;
          }

          momCol[y] += delta;
          momCol[y] *= 0.9;

          nextCol[y] = Math.max(0, Math.min(255, current + momCol[y]));
        }
      }

      grid = next;
      drawGrid();
    }

    let playing = true;
    function loop() {
      if (playing) update();
      requestAnimationFrame(loop);
    }

    let isDrawing = false;

    canvas.addEventListener("mousedown", (e) => {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
      const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);
      const drawVal = document.getElementById("eraser").checked ? 0 : parseInt(document.getElementById("drawIntensity").value);
      const brushSize = parseInt(document.getElementById("brushSize").value);

      const startX = Math.floor(mouseX / resolution) - Math.floor(brushSize / 2);
      const startY = Math.floor(mouseY / resolution) - Math.floor(brushSize / 2);

      for (let dx = 0; dx < brushSize; dx++) {
        for (let dy = 0; dy < brushSize; dy++) {
          const x = startX + dx;
          const y = startY + dy;
          if (x >= 0 && x < cols && y >= 0 && y < rows) {
            grid[x][y] = drawVal;
            momentum[x][y] = 0;
          }
        }
      }
      drawGrid();
    });
    canvas.addEventListener("mouseup", () => isDrawing = false);
    canvas.addEventListener("mouseleave", () => isDrawing = false);
    canvas.addEventListener("mousemove", (e) => {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
      const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);
      const drawVal = document.getElementById("eraser").checked ? 0 : parseInt(document.getElementById("drawIntensity").value);
      const brushSize = parseInt(document.getElementById("brushSize").value);

      const startX = Math.floor(mouseX / resolution) - Math.floor(brushSize / 2);
      const startY = Math.floor(mouseY / resolution) - Math.floor(brushSize / 2);

      for (let dx = 0; dx < brushSize; dx++) {
        for (let dy = 0; dy < brushSize; dy++) {
          const x = startX + dx;
          const y = startY + dy;
          if (x >= 0 && x < cols && y >= 0 && y < rows) {
            grid[x][y] = drawVal;
            momentum[x][y] = 0;
          }
        }
      }
      drawGrid();
    });

    drawGrid();
    [
      'birthMin', 'birthMax', 'birthBoost',
      'surviveMin', 'surviveMax', 'survivalGain',
      'decayRate', 'drawIntensity', 'brushSize'
    ].forEach(id => {
      const el = document.getElementById(id);
      const label = document.getElementById(id + 'Label');
      if (el && label) label.textContent = el.value;
    });
    loop();

    document.getElementById("togglePlay").addEventListener("click", () => {
      playing = !playing;
      document.getElementById("togglePlay").textContent = playing ? "Pause" : "Play";
    });

    document.getElementById("clearButton").addEventListener("click", () => {
      for (let x = 0; x < cols; x++) {
        for (let y = 0; y < rows; y++) {
          grid[x][y] = 0;
          momentum[x][y] = 0;
        }
      }
      drawGrid();
    });

    function copyPresetCode() {
      const values = [
        'birthMin', 'birthMax', 'surviveMin', 'surviveMax',
        'birthBoost', 'decayRate', 'survivalGain',
        'drawIntensity', 'brushSize'
      ].map(id => document.getElementById(id).value);
      const preset = values.join(',');
      const presetInput = document.getElementById('presetInput');
      presetInput.value = preset;
      presetInput.select();
      document.execCommand('copy');
      alert('Preset copied!');
    }

    function applyPresetCode() {
      const code = document.getElementById('presetInput').value;
      const values = code.split(',');
      const ids = [
        'birthMin', 'birthMax', 'surviveMin', 'surviveMax',
        'birthBoost', 'decayRate', 'survivalGain',
        'drawIntensity', 'brushSize'
      ];
      if (values.length !== ids.length) {
        alert('Invalid code');
        return;
      }
      ids.forEach((id, i) => {
        const el = document.getElementById(id);
        el.value = values[i];
        const label = document.getElementById(id + 'Label');
        if (label) label.textContent = values[i];
      });
    }

    function setPreset(code) {
      document.getElementById('presetInput').value = code;
      applyPresetCode();
    }
  </script>
</body>
</html>
