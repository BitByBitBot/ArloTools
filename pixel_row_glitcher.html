<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Row & Column Glitcher â€” Brutalist</title>
  <style>
    body {
      margin: 0;
      background: white;
      color: black;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    h1 {
      font-size: 1.4rem;
      border-bottom: 2px solid black;
      padding: 0.5rem;
      margin: 0;
      text-align: center;
    }
    main {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    .controls {
      border-right: 2px solid black;
      border-top: 2px solid black;
      border-bottom: 2px solid black;
      padding: 1rem;
      width: 250px;
      box-sizing: border-box;
      text-align: left;
    }
    label {
      display: block;
      margin: 1rem 0 0.2rem 0;
      font-weight: bold;
    }
    input[type="file"], input[type="range"] {
      border: 2px solid black;
      background: white;
      color: black;
      font-family: monospace;
      padding: 0.3rem;
      margin-bottom: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    input[type="range"] {
      width: 100%;
    }
    .canvas-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
    }
    canvas {
      border: 2px solid black;
      image-rendering: pixelated;
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <h1>Row & Column Glitcher</h1>
  <main>
    <div class="controls">
      <label for="imageLoader">Load Image:</label>
      <input type="file" id="imageLoader" accept="image/*" />

      <label for="shiftSlider">Horizontal Row Shift:</label>
      <input type="range" id="shiftSlider" min="-100" max="100" value="0" />

      <label for="vShiftSlider">Vertical Column Shift:</label>
      <input type="range" id="vShiftSlider" min="-100" max="100" value="0" />
    </div>
    <div class="canvas-container">
      <canvas id="glitchCanvas"></canvas>
    </div>
  </main>

  <script>
    const imageLoader = document.getElementById('imageLoader');
    const canvas = document.getElementById('glitchCanvas');
    const ctx = canvas.getContext('2d');
    const hSlider = document.getElementById('shiftSlider');
    const vSlider = document.getElementById('vShiftSlider');

    let img = new Image();
    let originalImageData;

    imageLoader.addEventListener('change', function (e) {
      const reader = new FileReader();
      reader.onload = function (event) {
        img.onload = function () {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        }
        img.src = event.target.result;
      }
      reader.readAsDataURL(e.target.files[0]);
    });

    function applyGlitch() {
      if (!originalImageData) return;

      const hShift = parseInt(hSlider.value);
      const vShift = parseInt(vSlider.value);
      const width = canvas.width;
      const height = canvas.height;
      const src = originalImageData.data;
      const output = ctx.createImageData(width, height);
      const dst = output.data;

      for (let y = 0; y < height; y++) {
        const vOffset = ((y * hShift) % width + width) % width;
        for (let x = 0; x < width; x++) {
          const hOffset = ((x * vShift) % height + height) % height;
          const srcY = (y + hOffset) % height;
          const srcX = (x + vOffset) % width;

          const srcIndex = (srcY * width + srcX) * 4;
          const dstIndex = (y * width + x) * 4;

          dst[dstIndex] = src[srcIndex];       // R
          dst[dstIndex + 1] = src[srcIndex + 1]; // G
          dst[dstIndex + 2] = src[srcIndex + 2]; // B
          dst[dstIndex + 3] = src[srcIndex + 3]; // A
        }
      }
      ctx.putImageData(output, 0, 0);
    }

    hSlider.addEventListener('input', applyGlitch);
    vSlider.addEventListener('input', applyGlitch);
  </script>
</body>
</html>
